<html>
	<head>

	</head>

	<body>
		<h1>Chat</h1>

		<div id="pages">
		<button onClick="switchPage('Broadcast')">Broadcast</button>
		</div>

		<ul id="messagesList">
		</ul>

		<br/>
		<br/>
		<input type="input" id="textBox"/>
		<button onClick="sendMessage()">Send message</button>

		<script type="text/javascript">
			var messages = {Broadcast:[]};
			var selectedPage = "Broadcast";

			const initialMessages = {{InitialMessages}};
			for (var i = 0; i < initialMessages.length; i++)
			{
				visualizeMessageSS("Broadcast", initialMessages[i]);
			}


			function visualizeMessageSS(page, message)
			{
				if (messages[page] === undefined)
				{
					messages[page] = [];
					createPageButton(page);
				}
				messages[page].push(message);

				reloadList();
			}

			function reloadList()
			{
				const list = document.getElementById("messagesList");
				removeAllChildNodes(list);

				const messagesList = messages[selectedPage];

				for (var i = 0; i < messagesList.length; i++)
				{
					var message = messagesList[i];

					const li = document.createElement("li");
					const div = document.createElement("div");
					const br = document.createElement("br");

					div.append("||" + message.Type + "|| " + message.Author + ": " + message.Content);

					li.append(div);
					list.append(li);
					list.append(br);
				}
			}

			function switchPage(page)
			{
				selectedPage = page;
				reloadList();
			}

			function createPageButton(page)
			{
				const pages = document.getElementById("pages");
				const button = document.createElement("button");

				button.append(page);
				button.addEventListener("click", function() { switchPage(page); });

				pages.append(button);
			}

			async function sendMessage()
			{
				const textbox = document.getElementById("textBox");

				if (textBox.value == "")
					return;

				const reciver = selectedPage == "Broadcast" ? null : selectedPage.substring(1);
				await context.sendMessage(reciver, textbox.value, 0);
				visualizeMessageSS(selectedPage, { Author: "You", Content: textbox.value, Type: 0 });
				textbox.value = "";
			}

			function removeAllChildNodes(parent)
			{
				while (parent.firstChild)
				{
						parent.removeChild(parent.firstChild);
				}
			}
		</script>
	</body>
</html>
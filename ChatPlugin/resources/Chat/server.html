<html>
	<head>

	</head>

	<body>
		<h1>Chat</h1>

		<div id="pages">
		<button onClick="switchPage('Broadcast')">Broadcast</button>
		</div>

		<ul id="messagesList">
		</ul>

		<br/>
		<br/>
		<input type="input" id="textBox"/>
		<button onClick="sendMessage()">Send message</button>
		<button onClick="uploadFile()">Upload</button>

		<script type="text/javascript">
			var broadcastPage = "Broadcast";
			var messages = {Broadcast:{{InitialMessages}}};
			var selectedPage = broadcastPage;
			reloadList();


			function visualizeMessageSS(page, message)
			{
				if (page === null)
				{
					page = broadcastPage;
				}

				if (messages[page] === undefined)
				{
					messages[page] = [];
					createPageButton(page);
				}
				messages[page].push(message);

				reloadList();
			}

			function reloadList()
			{
				const list = document.getElementById("messagesList");
				removeAllChildNodes(list);

				const messagesList = messages[selectedPage];

				for (var i = 0; i < messagesList.length; i++)
				{
					const li = document.createElement("li");
					const div = document.createElement("div");
					const br = document.createElement("br");

					var message = messagesList[i];

					if (message.Type == "Text")
					{
						div.append("" + message.Author + ": " + message.Content);
					}
					else if (message.Type == "File")
					{
						var downloadBtn = document.createElement("button");
						downloadBtn.append(message.Content);
						div.append(downloadBtn);
					}
					else
					{
						div.append("Invalid message type");
					}

					li.append(div);
					list.append(li);
					list.append(br);
				}
			}

			function switchPage(page)
			{
				selectedPage = page;
				reloadList();
			}

			function createPageButton(page)
			{
				const pages = document.getElementById("pages");
				const button = document.createElement("button");

				button.append(page);
				button.addEventListener("click", function() { switchPage(page); });

				pages.append(button);
			}

			async function sendMessage()
			{
				const textbox = document.getElementById("textBox");

				if (textBox.value == "")
					return;

				const reciver = selectedPage == broadcastPage ? null : selectedPage;
				await context.sendMessage(reciver, textbox.value, "Text");
				textbox.value = "";
			}

			function removeAllChildNodes(parent)
			{
				while (parent.firstChild)
				{
						parent.removeChild(parent.firstChild);
				}
			}
		</script>
	</body>
</html>